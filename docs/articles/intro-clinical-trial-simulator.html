<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Intro to Clinical Trial Simulator • clinicalTrialSimulator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Intro to Clinical Trial Simulator">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clinicalTrialSimulator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JorAlEs/clinical-trial-simulator-R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Intro to Clinical Trial Simulator</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JorAlEs/clinical-trial-simulator-R/blob/main/vignettes/intro-clinical-trial-simulator.Rmd" class="external-link"><code>vignettes/intro-clinical-trial-simulator.Rmd</code></a></small>
      <div class="d-none name"><code>intro-clinical-trial-simulator.Rmd</code></div>
    </div>

    
    
<p>#Introduction This vignette demonstrates how to use the
clinicalTrialSimulator package to simulate a simple clinical trial from
start to finish. We will simulate patient demographics, randomize
patients to treatment arms, generate time-to-event outcomes (e.g.,
survival), simulate dropouts (including some related to adverse events),
produce longitudinal repeated measures, and finally compile the
subject-level analysis dataset (ADSL).</p>
<div class="section level3">
<h3 id="simulating-patient-characteristics">Simulating Patient Characteristics<a class="anchor" aria-label="anchor" href="#simulating-patient-characteristics"></a>
</h3>
<p>First, we simulate the baseline patient demographics and site
information. In this example, we simulate 100 patients across 2
countries (with 5 sites per country). Each patient has an ID, is
assigned to a country and site, and has attributes like age and sex.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate baseline data for 100 patients in 2 countries with 5 sites each</span></span>
<span><span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_patients.html">simulate_patients</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, countries <span class="op">=</span> <span class="fl">2</span>, sites_per_country <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                              mean_age <span class="op">=</span> <span class="fl">50</span>, sd_age <span class="op">=</span> <span class="fl">10</span>, prop_female <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co"># Inspect first few patients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">patients</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    ID  Country   Site Age    Sex</span></span>
<span><span class="co">## 1   1 Country1  Site3  54 Female</span></span>
<span><span class="co">## 2   2 Country1  Site3  46   Male</span></span>
<span><span class="co">## 3   3 Country2 Site10  56   Male</span></span>
<span><span class="co">## 4   4 Country1  Site2  48 Female</span></span>
<span><span class="co">## 5   5 Country2  Site6  53   Male</span></span>
<span><span class="co">## 6   6 Country1  Site5  61   Male</span></span>
<span><span class="co">## 7   7 Country1  Site4  54   Male</span></span>
<span><span class="co">## 8   8 Country2  Site6  47   Male</span></span>
<span><span class="co">## 9   9 Country2  Site9  61   Male</span></span>
<span><span class="co">## 10 10 Country2 Site10  60   Male</span></span></code></pre>
<p>Each row represents a patient with their demographic information. We
see columns for ID, Country, Site, Age, and Sex. These will serve as the
starting point for further simulations.</p>
<p>##Treatment Allocation</p>
<p>Next, we randomize patients into treatment groups. Let’s assume a
two-arm trial with equal allocation between a placebo and an active
drug.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Randomly allocate patients to two arms: Placebo vs Drug (1:1 ratio)</span></span>
<span><span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_allocation.html">simulate_allocation</a></span><span class="op">(</span><span class="va">patients</span>, arm_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Placebo"</span>, <span class="st">"Drug"</span><span class="op">)</span>, ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">patients</span><span class="op">$</span><span class="va">Arm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Placebo    Drug </span></span>
<span><span class="co">##      49      51</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">patients</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   ID  Country   Site Age    Sex     Arm</span></span>
<span><span class="co">## 1  1 Country1  Site3  54 Female    Drug</span></span>
<span><span class="co">## 2  2 Country1  Site3  46   Male    Drug</span></span>
<span><span class="co">## 3  3 Country2 Site10  56   Male Placebo</span></span>
<span><span class="co">## 4  4 Country1  Site2  48 Female    Drug</span></span>
<span><span class="co">## 5  5 Country2  Site6  53   Male    Drug</span></span></code></pre>
<p>The output shows the distribution of patients between the “Placebo”
and “Drug” arms and the updated data frame now includes an Arm column
indicating each patient’s assigned group.</p>
<p>##Simulating Survival (Time-to-Event) Outcome</p>
<p>Suppose the primary endpoint is a time-to-event outcome (e.g.,
overall survival). We will simulate survival times with a specified
median for the placebo group and a hazard ratio for the drug group. Here
we assume the placebo median survival is 24 months and the drug is
expected to improve survival with a hazard ratio of 0.6 (i.e., 40%
reduction in hazard). We also define a maximum study follow-up of 36
months.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate survival times (e.g., overall survival) with median 24 for placebo and HR 0.6 for drug</span></span>
<span><span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_survival.html">simulate_survival</a></span><span class="op">(</span><span class="va">patients</span>, median_time_control <span class="op">=</span> <span class="fl">24</span>, hr <span class="op">=</span> <span class="fl">0.6</span>, study_duration <span class="op">=</span> <span class="fl">36</span><span class="op">)</span></span>
<span><span class="co"># Check a summary of event status by arm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">patients</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Arm</span>, <span class="va">EventStatus</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          EventStatus</span></span>
<span><span class="co">## Arm        0  1</span></span>
<span><span class="co">##   Placebo 21 28</span></span>
<span><span class="co">##   Drug    24 27</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">patients</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Arm"</span>,<span class="st">"EventTime"</span>,<span class="st">"EventStatus"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    ID     Arm EventTime EventStatus</span></span>
<span><span class="co">## 1   1    Drug 31.079753           1</span></span>
<span><span class="co">## 2   2    Drug 36.000000           0</span></span>
<span><span class="co">## 3   3 Placebo 10.405513           1</span></span>
<span><span class="co">## 4   4    Drug 17.747074           1</span></span>
<span><span class="co">## 5   5    Drug 36.000000           0</span></span>
<span><span class="co">## 6   6 Placebo 21.626910           1</span></span>
<span><span class="co">## 7   7    Drug  5.427236           1</span></span>
<span><span class="co">## 8   8 Placebo 13.279536           1</span></span>
<span><span class="co">## 9   9    Drug 10.094406           1</span></span>
<span><span class="co">## 10 10 Placebo 36.000000           0</span></span></code></pre>
<p>The EventTime column represents either the time of event (if the
event occurred) or the censoring time (if the patient did not have an
event by end of follow-up). EventStatus is 1 if the event occurred, or 0
if the time is a censoring time (e.g., the patient was event-free at
study end or dropped out before event as we will simulate next). The
contingency table above shows how many events (1) and censored
observations (0) occurred in each arm; we expect fewer events in the
Drug arm due to the hazard reduction.</p>
<p>##Simulating Dropouts Patients may drop out of the trial (for reasons
like loss to follow-up or withdrawal due to adverse events). We simulate
dropouts such that about 30% of patients withdraw by 36 months. We will
also illustrate an original feature: increasing dropout risk for
patients who experience a serious adverse event (AE). Let’s say 20% of
patients will have a simulated serious AE, and those patients have twice
the hazard of dropout.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate dropouts: 30% dropout rate by 36 months</span></span>
<span><span class="co"># 20% of patients have a serious AE which doubles their dropout hazard</span></span>
<span><span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_dropout.html">simulate_dropout</a></span><span class="op">(</span><span class="va">patients</span>, dropout_rate <span class="op">=</span> <span class="fl">0.3</span>, study_duration <span class="op">=</span> <span class="fl">36</span>,</span>
<span>                             p_ae <span class="op">=</span> <span class="fl">0.2</span>, dropout_hr_ae <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Inspect dropout and AE columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">patients</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Arm</span>, <span class="va">Dropped</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          Dropped</span></span>
<span><span class="co">## Arm       FALSE TRUE</span></span>
<span><span class="co">##   Placebo    36   13</span></span>
<span><span class="co">##   Drug       35   16</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">patients</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SeriousAE</span>, <span class="va">Dropped</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          Dropped</span></span>
<span><span class="co">## SeriousAE FALSE TRUE</span></span>
<span><span class="co">##     FALSE    59   20</span></span>
<span><span class="co">##     TRUE     12    9</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">patients</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Arm"</span>,<span class="st">"SeriousAE"</span>,<span class="st">"DropoutTime"</span>,<span class="st">"Dropped"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    ID     Arm SeriousAE DropoutTime Dropped</span></span>
<span><span class="co">## 1   1    Drug     FALSE   18.147944    TRUE</span></span>
<span><span class="co">## 2   2    Drug      TRUE    6.225057    TRUE</span></span>
<span><span class="co">## 3   3 Placebo     FALSE          NA   FALSE</span></span>
<span><span class="co">## 4   4    Drug     FALSE          NA   FALSE</span></span>
<span><span class="co">## 5   5    Drug     FALSE   21.314232    TRUE</span></span>
<span><span class="co">## 6   6 Placebo     FALSE    5.307033    TRUE</span></span>
<span><span class="co">## 7   7    Drug     FALSE          NA   FALSE</span></span>
<span><span class="co">## 8   8 Placebo     FALSE          NA   FALSE</span></span>
<span><span class="co">## 9   9    Drug     FALSE          NA   FALSE</span></span>
<span><span class="co">## 10 10 Placebo     FALSE          NA   FALSE</span></span></code></pre>
<p>We can see the SeriousAE flag indicating which patients had the
adverse event and the DropoutTime and Dropped columns indicating if and
when patients left the study. The first table shows the number of
dropouts (Dropped=TRUE) by arm, and the second table illustrates that
patients with serious AEs tend to have a higher dropout rate (rows where
SeriousAE=TRUE likely show more dropouts). Note: Patients who died (had
the event) before they could drop out are treated as not dropped. The
simulation logic censors the survival time at dropout if dropout occurs
first, or ignores the dropout if an event occurred first. Thus, each
patient’s timeline is appropriately handled.</p>
</div>
<div class="section level3">
<h3 id="simulating-longitudinal-outcomes">Simulating Longitudinal Outcomes<a class="anchor" aria-label="anchor" href="#simulating-longitudinal-outcomes"></a>
</h3>
<p>Now let’s simulate a longitudinal outcome, for example a biomarker
measured at clinic visits over time. We’ll assume visits at baseline and
every 6 months up to 24 months (so 0, 6, 12, 18, 24). We also
incorporate a treatment effect on this biomarker: perhaps the biomarker
decreases over time in the treatment group compared to placebo. We set
up a scenario where the placebo group stays roughly constant on average,
while the treatment group sees an improvement (decrease) of about 1 unit
every 6 months. We also include a random site effect to demonstrate
multi-level data (each site has a random offset on the biomarker).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define planned visit times (months)</span></span>
<span><span class="va">visit_schedule</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">24</span><span class="op">)</span></span>
<span><span class="co"># Generate the schedule of visits for each patient (accounting for dropouts and deaths)</span></span>
<span><span class="va">visits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_visits.html">simulate_visits</a></span><span class="op">(</span><span class="va">patients</span>, visit_times <span class="op">=</span> <span class="va">visit_schedule</span><span class="op">)</span></span>
<span><span class="co"># Simulate longitudinal biomarker outcomes:</span></span>
<span><span class="co"># baseline mean = 100, control group slope ~ 0 per month, treatment slope = -0.2 per month (improvement),</span></span>
<span><span class="co"># measurement error SD = 5, and random site intercept SD = 3.</span></span>
<span><span class="va">visit_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_longitudinal_outcomes.html">simulate_longitudinal_outcomes</a></span><span class="op">(</span><span class="va">visits</span>, <span class="va">patients</span>,</span>
<span>                                             baseline_mean <span class="op">=</span> <span class="fl">100</span>, baseline_sd <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                                             control_slope <span class="op">=</span> <span class="fl">0</span>, treatment_slope <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>,</span>
<span>                                             error_sd <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                             cluster_var <span class="op">=</span> <span class="st">"Site"</span>, cluster_effect_sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># Look at some longitudinal data points</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">visit_data</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    ID Time     Arm   Site  Country   Outcome</span></span>
<span><span class="co">## 1   1    0    Drug  Site3 Country1  98.27484</span></span>
<span><span class="co">## 2   1    6    Drug  Site3 Country1 111.83072</span></span>
<span><span class="co">## 3   1   12    Drug  Site3 Country1  95.44381</span></span>
<span><span class="co">## 4   1   18    Drug  Site3 Country1  98.60257</span></span>
<span><span class="co">## 5   2    0    Drug  Site3 Country1  99.38935</span></span>
<span><span class="co">## 6   2    6    Drug  Site3 Country1 101.99665</span></span>
<span><span class="co">## 7   3    0 Placebo Site10 Country2  98.83889</span></span>
<span><span class="co">## 8   3    6 Placebo Site10 Country2 104.58937</span></span>
<span><span class="co">## 9   4    0    Drug  Site2 Country1  96.50052</span></span>
<span><span class="co">## 10  4    6    Drug  Site2 Country1 100.27258</span></span></code></pre>
<p>In the visit_data, each patient has multiple rows (one per visit)
with an Outcome value for the biomarker. The Arm, Site, and Country
columns provide context for each measurement. Patients who dropped out
or died before certain visits will have no entries for those later times
(e.g., if a patient dropped at month 18, you will not see a 24-month
record for them). We can examine the treatment effect by comparing the
biomarker values at baseline and 24 months for each arm:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Baseline and final visit outcomes by treatment arm</span></span>
<span><span class="va">baseline_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">visit_data</span>, <span class="va">Time</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">final_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">visit_data</span>, <span class="va">Time</span> <span class="op">==</span> <span class="fl">24</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean outcome at baseline by arm:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Mean outcome at baseline by arm:</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">baseline_data</span><span class="op">$</span><span class="va">Outcome</span>, <span class="va">baseline_data</span><span class="op">$</span><span class="va">Arm</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  Placebo     Drug </span></span>
<span><span class="co">## 99.19378 99.88680</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean outcome at 24 months by arm:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Mean outcome at 24 months by arm:</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">final_data</span><span class="op">$</span><span class="va">Outcome</span>, <span class="va">final_data</span><span class="op">$</span><span class="va">Arm</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  Placebo     Drug </span></span>
<span><span class="co">## 97.94677 98.08435</span></span></code></pre>
<p>We expect the baseline means to be roughly equal (by design), and by
24 months the Drug arm has a lower mean outcome (indicating improvement)
compared to Placebo. The random site effect and error add variability,
so these are average trends.</p>
</div>
<div class="section level3">
<h3 id="simulating-a-binary-outcome">Simulating a Binary Outcome<a class="anchor" aria-label="anchor" href="#simulating-a-binary-outcome"></a>
</h3>
<p>For illustration, let’s also simulate a binary endpoint, such as an
overall response (Yes/No) at end of study. We will assume, for example,
a 40% response rate in the placebo group and a 60% response rate in the
drug group. We’ll add this as a single outcome per patient.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate a binary outcome (e.g., treatment response)</span></span>
<span><span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_outcomes.html">simulate_outcomes</a></span><span class="op">(</span><span class="va">patients</span>, outcome_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>                              outcome_prob_control <span class="op">=</span> <span class="fl">0.4</span>, outcome_prob_treatment <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co"># Response rates by arm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">patients</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Arm</span>, <span class="va">Outcome</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          Outcome</span></span>
<span><span class="co">## Arm       No Yes</span></span>
<span><span class="co">##   Placebo  9   4</span></span>
<span><span class="co">##   Drug     5  11</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">patients</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Arm"</span>,<span class="st">"Outcome"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    ID     Arm Outcome</span></span>
<span><span class="co">## 1   1    Drug    &lt;NA&gt;</span></span>
<span><span class="co">## 2   2    Drug    &lt;NA&gt;</span></span>
<span><span class="co">## 3   3 Placebo    &lt;NA&gt;</span></span>
<span><span class="co">## 4   4    Drug    &lt;NA&gt;</span></span>
<span><span class="co">## 5   5    Drug    &lt;NA&gt;</span></span>
<span><span class="co">## 6   6 Placebo    &lt;NA&gt;</span></span>
<span><span class="co">## 7   7    Drug    &lt;NA&gt;</span></span>
<span><span class="co">## 8   8 Placebo    &lt;NA&gt;</span></span>
<span><span class="co">## 9   9    Drug    &lt;NA&gt;</span></span>
<span><span class="co">## 10 10 Placebo      No</span></span></code></pre>
<p>The output shows the number of responders (“Yes”) vs non-responders
(“No”) in each arm. The simulation assigns “Yes”/“No” taking into
account the specified probabilities. Note that patients who dropped out
or died have their Outcome set to NA (missing), as they did not complete
the study to have a measured response.</p>
</div>
<div class="section level3">
<h3 id="creating-the-adsl-dataset">Creating the ADSL Dataset<a class="anchor" aria-label="anchor" href="#creating-the-adsl-dataset"></a>
</h3>
<p>Finally, we compile all the simulated data into a single
subject-level analysis dataset (ADSL). This will include one row per
patient with their baseline info, treatment, and outcomes.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_adam_format.html">export_adam_format</a></span><span class="op">(</span><span class="va">patients</span>, study_id <span class="op">=</span> <span class="st">"SIMTRIAL01"</span><span class="op">)</span></span>
<span><span class="co"># Examine the first few records of ADSL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      STUDYID      USUBJID ID  Country   Site     Arm Age    Sex SeriousAE</span></span>
<span><span class="co">## 1 SIMTRIAL01 SIMTRIAL01-1  1 Country1  Site3    Drug  54 Female     FALSE</span></span>
<span><span class="co">## 2 SIMTRIAL01 SIMTRIAL01-2  2 Country1  Site3    Drug  46   Male      TRUE</span></span>
<span><span class="co">## 3 SIMTRIAL01 SIMTRIAL01-3  3 Country2 Site10 Placebo  56   Male     FALSE</span></span>
<span><span class="co">## 4 SIMTRIAL01 SIMTRIAL01-4  4 Country1  Site2    Drug  48 Female     FALSE</span></span>
<span><span class="co">## 5 SIMTRIAL01 SIMTRIAL01-5  5 Country2  Site6    Drug  53   Male     FALSE</span></span>
<span><span class="co">##   DropoutTime Dropped EventTime EventStatus Outcome</span></span>
<span><span class="co">## 1   18.147944    TRUE 18.147944           0    &lt;NA&gt;</span></span>
<span><span class="co">## 2    6.225057    TRUE  6.225057           0    &lt;NA&gt;</span></span>
<span><span class="co">## 3          NA   FALSE 10.405513           1    &lt;NA&gt;</span></span>
<span><span class="co">## 4          NA   FALSE 17.747074           1    &lt;NA&gt;</span></span>
<span><span class="co">## 5   21.314232    TRUE 21.314232           0    &lt;NA&gt;</span></span></code></pre>
<p>The adsl data frame contains columns like STUDYID (study identifier),
USUBJID (unique subject ID), treatment Arm, demographic variables (Age,
Sex, etc.), and the various outcomes: - EventTime and EventStatus
(time-to-event outcome and censoring status), - DropoutTime and Dropped
(dropout information), - Outcome (our binary response outcome in this
case). Each patient’s row aggregates all their relevant information. For
example, if a patient died during the trial, EventStatus=1 and EventTime
is when it happened; if a patient dropped out, Dropped=TRUE and
DropoutTime is given (and their Outcome may be NA due to missing data
from dropout).</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>We have simulated a complete clinical trial dataset. The
clinicalTrialSimulator package allowed us to generate: - Demographics
and multi-level site data, - Treatment assignments, - Time-to-event
outcomes with treatment effect, - Dropouts including those triggered by
adverse events, - Longitudinal repeated measures with treatment and site
effects, - A binary endpoint, - A compiled ADSL dataset for
analysis.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jorge Alcántara.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
