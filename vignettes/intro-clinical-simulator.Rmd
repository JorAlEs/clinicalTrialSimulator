---
title: "Clinical Trial Simulation Workflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Clinical Trial Simulation Workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
library(clinicalTrialSimulator)
set.seed(123)  # Set seed for reproducibility in this vignette

```

#Introduction

This vignette demonstrates how to use the clinicalTrialSimulator package to simulate a simple clinical trial from start to finish. We will simulate patient demographics, randomize patients to treatment arms, generate time-to-event outcomes (e.g., survival), simulate dropouts (including some related to adverse events), produce longitudinal repeated measures, and finally compile the subject-level analysis dataset (ADSL).

##Simulating Patient Characteristics

First, we simulate the baseline patient demographics and site information. In this example, we simulate 100 patients across 2 countries (with 5 sites per country). Each patient has an ID, is assigned to a country and site, and has attributes like age and sex.

```{r}
# Simulate baseline data for 100 patients in 2 countries with 5 sites each
patients <- simulate_patients(n = 100, countries = 2, sites = 5,
                              age_mean = 50, age_sd = 10)



# Inspect first few patients
head(patients, 10)

```


Each row represents a patient with their demographic information. We see columns for ID, Country, Site, Age, and Sex. These will serve as the starting point for further simulations.

## Treatment Allocation

Next, we randomize patients into treatment groups. Let's assume a two-arm trial with equal allocation between a placebo and an active drug.

```{r}
# Randomly allocate patients to two arms: Placebo vs Drug (1:1 ratio)
patients <- simulate_allocation(patients, arms = c("Placebo", "Drug"), ratio = c(1, 1))

table(patients$ARM)
head(patients, 5)

```

The output shows the distribution of patients between the "Placebo" and "Drug" arms and the updated data frame now includes an Arm column indicating each patient's assigned group.

## Simulating Survival (Time-to-Event) Outcome

Suppose the primary endpoint is a time-to-event outcome (e.g., overall survival). We will simulate survival times with a specified median for the placebo group and a hazard ratio for the drug group. Here we assume the placebo median survival is 24 months and the drug is expected to improve survival with a hazard ratio of 0.6 (i.e., 40% reduction in hazard). We also define a maximum study follow-up of 36 months.

```{r}
# Simulate survival times (e.g., overall survival) with median 24 for placebo and HR 0.6 for drug
patients <- simulate_survival(patients, median_time_control = 24, hr = 0.6, study_duration = 36)




simulate_survival()
# Check a summary of event status by arm
with(patients, table(Arm, EventStatus))
head(patients[c("ID","Arm","EventTime","EventStatus")], 10)

```

